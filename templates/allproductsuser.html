<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename = 'register.css') }}">
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename = 'table.css') }}">
	<link href="https://fonts.googleapis.com/css2?family=Poiret+One&display=swap" rel="stylesheet">
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

	<!-- Adding Bootstrap Links -->

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

	<!-- Bootstrap Links Ends  -->

	<title>All Products</title>

	<script>
		function myFunction() {
		  var x = document.getElementById("myTopnav");
		  if (x.className === "topnav") {
			x.className += " responsive";
		  } else {
			x.className = "topnav";
		  }
		}
	</script>

	<script>
		function cross(x) {
		x.classList.toggle("change");
		}
	</script>

	<!-- THIS IS THE JAVASCRIPT FOR THE FORM FOR SUBMITTING REQUIRED QUANTITY -->
	<script type="text/javascript">
		function openForm() {
		document.getElementById("myForm").style.display = "block";
		}

		function closeForm() {
		document.getElementById("myForm").style.display = "none";
		}

		function sendItemId(item_id) {
		document.querySelector("#receive_item_id").value =  item_id;
		}

		function setProductCode(product_code, callback) {
		document.querySelector("#receive_product_code").value =  product_code;
		callback();
		}

		function submitDeleteRequestForm(){
			document.getElementById("delete_product_request_form").submit();
		}

	</script>
	<!-- jAVASCRIPT FOR FORM ENDS -->

	<!-- MAY BE USED IN FUTURE SO NOT DELETING THE BELOW JAVASCRIPT AND ITS RELATED FORMS -->

	<!-- <script type="text/javascript">

		// document.addEventListener("DOMContentLoaded", getEmailOrPhone);
		// function getEmailOrPhone(){
		// 	var email_Or_Phone = localStorage.getItem("email_Or_Phone")
		// 	document.querySelector("#receive_email_or_phone").value= email_Or_Phone  
		// 	document.querySelector("#user_email_or_phone").value= email_Or_Phone    
		// }   

		// document.addEventListener("DOMContentLoaded", getEmailOrPhonePopupForm);
		// function getEmailOrPhonePopupForm(){
		// 	var popup_form_email_Or_Phone = localStorage.getItem("popup_form_email_Or_Phone")
		// 	document.querySelector("#receive_email_or_phone").value= popup_form_email_Or_Phone  
		// 	document.querySelector("#user_email_or_phone").value= popup_form_email_Or_Phone    
		// }

	</script> -->


	<!-- <script type="text/javascript">
		function submitForm(form_action){
			document.getElementById("requesteditems").action = form_action;
			document.getElementById("requesteditems").submit();
		}
	</script>
	<script type="text/javascript">
		function redirectHome(){
			document.getElementById("homeredirectform").submit();
		}
	</script> -->

</head>

<body>

	<div class="topnav" id="myTopnav">   
		<a class="active" href="/homeredirect"><i class="fa fa-fw fa-home"></i>Home</a>
		<a href = '/userrequesteditems'>Requested Items</a>
		<a href = '/userissueditems'>Issued Items</a>
		<a href = '/userreturneditems'>Returned Items</a>
		<a href = '/userrejectedrequests'>Rejected Requests</a>
		<a id = 'bar' href="javascript:void(0);" class="icon" onclick="myFunction()">
			<!-- <i class="fa fa-bars"></i> -->

		<div id="bar-container" class="container" onclick="cross(this)">
			<div class="bar1"></div>
			<div class="bar2"></div>
			<div class="bar3"></div>
		</div>

		</a>
		<div class="topnav-right">
			<a href="/logoutgeneraluser">Logout</a>
			<a href="/updatepassword">Update</a>
		</div>
	</div>

	{% with messages = get_flashed_messages() %}
	{% if messages %}
	{% for message in messages %}
	<script>
		swal("{{ message }}", "",'{{alert_type}}' );
	</script>

	{% endfor %}
	{% endif %}
	{% endwith %}

	<center>
		<h1>These are all the items available in the Store </h1>
		<div style="overflow-x:auto;">
			<table id="table">
				<tr>
					<th>ID</th>
					<th>Product Name</th>
					<th>Product Code</th>
					<th>Quantity Available</th>
					<th>Product Type</th>
					<th>Lowlevel Qty.</th>
					<th>Critical Level Qty.</th>
					<th>Max Issuable Qty.</th>
					<th style="text-align: right;">Add Requests</th>
					
				</tr>
				{% if all_products %}
				{% for item in all_products %}
				<tr>
					<td>{{ item.id }}</td>
					<td>{{ item.product_name }}</td>
					<td>{{ item.product_code }}</td>
					<td>{{ item.qty_available }}</td>
					<td>{{ item.product_type }}</td>
					<td>{{ item.lowlevel_qty }}</td>
					<td>{{ item.critical_level_qty }}</td>
					<td>{{ item.max_issuable_qty }}</td>
					<td style="text-align: right;"><button id="product-add-btn" type="button" class="btn btn-secondary" onclick="openForm(); sendItemId('{{item.id|tojson}}');">ADD</button>
					<!-- <button id="product-remove-btn" type="button" class="btn btn-secondary" onclick="setProductCode('{{item.product_code|tojson}}', submitDeleteRequestForm );">REMOVE</button> --></td>
				</tr>
				{% endfor %}
				{% else %}
				No results found
				{% endif %}

			</table>
		</div>
	</center>


	<div class="form-popup form" id="myForm">
	  <form action="/addrequest" class="form-container" method="POST">

		<label for="quantity" style="font-size: 22px; color: #ff5f6d;"><b><u>Quantity</u></b></label>
		<input id = "requested_qty" type="number" placeholder="Enter Required Quantity" name="Quantity" required style="outline: none; border: none; background-color: #f2f2f2;">


		<!-- COMMENT FOR "Quantity" INPUT FIELD ENDS -->
		<input id = "receive_item_id" type="hidden" name="product_id">

		<!-- INPUT FIELDS CONTAINING USER CREDENTIALS -->
		<input type = "hidden" name="first_name"  value="{{ first_name }}">
		<input type = "hidden" name="last_name"  value="{{ last_name }}">
		<input type = "hidden" name="department"  value="{{ department }}">
		<input type = "hidden" name="registered_as"  value="{{ registered_as }}">
		<!-- INPUT FIELD ENDS -->

		<div class = "signup-btn" style="text-align: left;">
			<button type="submit" class="" style="font-size: 11px;">Ok</button>
			<button type="button" class="" style="font-size: 11px;" onclick="closeForm()">Close</button>
		</div>
	  </form>
	</div>

	<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
	<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->

	<!-- THIS FORM SENDS THE DATA TO BE USED FOR DELETING THE REQUEST MADE BY USER -->
	<form action="/deleterequest" id="delete_product_request_form" method="POST">
		<!-- INPUT FIELDS CONTAINING USER CREDENTIALS -->
		<input type = "hidden" name="first_name"  value="{{ first_name }}">
		<input type = "hidden" name="last_name"  value="{{ last_name }}">
		<input type = "hidden" name="department"  value="{{ department }}">
		<input type = "hidden" name="registered_as"  value="{{ registered_as }}">
		<!-- INPUT FIELD ENDS -->

		<input id = "receive_product_code" type="hidden" name="product_code">
	</form>


	<!-- THE BELOW 2 FORMS ARE NOT BEING USED NOW BECAUSE THESE WERE USED TO SEND USER'S EMAIL OR PHONE TO EXTRACT UNIQUE INFORMATION OF USER BUT NOW WE ARE TAKING THE USER'S EMAIL FROM SESSION VARIABLE -->

	<!-- THIS FORM SENDS USER EMAIL OR NUMBER USED TO FETCH THE ITEMS ISSUED TO USER, OR REQUESTED BY USER, OR RETURNED BY USER--IMPORTANT FORM -->
	<!-- <form id="requesteditems" method="POST" style="display: block;">       
		<div>
			<input id = "receive_email_or_phone"  name="email_Or_Phone" readonly>
		</div>
	</form> -->

	<!-- THIS FORM IS USED TO SEND USER ID TO BE USED WHEN REDIRECTING TO HOME i.e. ALLPRODUCTSUSER.HTML FROM OTHER PAGES SUCH AS ISSUED ITEMS AND OTHERS -->
	<!-- <form action = "/homeredirect" id="homeredirectform" method="POST" style="display: none;">       
		<div>
			<input id = "user_email_or_phone" type = "hidden" name="user_email_or_phone" readonly>
		</div>
	</form> -->

</body>

</html>